{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport Cookies from 'universal-cookie';\n// TODO\nimport { userLogIn, userLogOut, userEditProfile } from '../../apis/index';\nconst cookies = new Cookies();\nconst initialState = {\n  user: cookies.get('user'),\n  userDraft: cookies.get('userDraft') // TODO temp for fake logged in user: {\n  //   name: 'Amit Bar',\n  //   email: \"'noneofyobusiness@gmail.com\",\n  //   imageUrl: 'image',\n  //   token: 'fake',\n  // },\n\n};\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action) => {\n      state.user = action.payload;\n\n      if (action.payload) {\n        cookies.set('user', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320 // expires  72 hours after login\n\n        });\n      } else {\n        cookies.remove('user');\n      }\n    },\n    setUserDraft: (state, action) => {\n      state.userDraft = action.payload;\n\n      if (action.payload) {\n        cookies.set('userDraft', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320 // expires  72 hours after login\n\n        });\n      } else {\n        cookies.remove('userDraft');\n      }\n    }\n  }\n}); // Export actions that were defined with createSlice\n\nexport const {\n  setUser,\n  setUserDraft\n} = authSlice.actions; // Thunks here\n\nexport const login = (name, email) => async (dispatch) => {\n  const response = await userLogIn(name, email);\n\n  if (response) {\n    dispatch(setUser({\n      name: response.name,\n      email: response.email,\n      token: response.token,\n      description: response.description,\n      major: response.major,\n      schoolYear: response.schoolYear,\n      phone: response.phone\n    }));\n    dispatch(setUserDraft({\n      name: response.name,\n      email: response.email,\n      token: response.token,\n      description: response.description,\n      major: response.major,\n      schoolYear: response.schoolYear,\n      phone: response.phone\n    }));\n  }\n}; // TODO this doesn't seem to be able to handle when the cookie times out\n\nexport const logout = () => async (dispatch, getState) => {\n  var _getState$auth$user;\n\n  // remove cookies here, which will automatically update the user\n  const token = (_getState$auth$user = getState().auth.user) === null || _getState$auth$user === void 0 ? void 0 : _getState$auth$user.token;\n  if (!token) return; // TODO doesn't work well anymore. I think it's cause we changed the backend\n\n  const response = await userLogOut(token);\n\n  if (response) {\n    dispatch(setUser(undefined));\n    dispatch(setUserDraft(undefined)); // TODO not sure if this is needed\n  }\n};\nexport const editProfile = (email, userDraft, kvPairs) => async dispatch => {\n  const response = await userEditProfile(email, kvPairs);\n\n  if (response) {\n    dispatch(setUser(userDraft));\n  }\n}; // Selects here\n\nconst selectUser = state => state.auth.user;\n\nconst selectUserDraft = state => state.auth.userDraft;\n\nexport { selectUser, selectUserDraft }; // Export everything\n\nexport default authSlice.reducer;","map":{"version":3,"sources":["/Users/yijianzong/Documents/GitHub/Housing_Proj/NewFrontEnd/src/redux/slices/auth.ts"],"names":["createSlice","Cookies","userLogIn","userLogOut","userEditProfile","cookies","initialState","user","get","userDraft","authSlice","name","reducers","setUser","state","action","payload","set","maxAge","remove","setUserDraft","actions","login","email","dispatch","response","token","description","major","schoolYear","phone","logout","getState","auth","undefined","editProfile","kvPairs","selectUser","selectUserDraft","reducer"],"mappings":"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","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport Cookies from 'universal-cookie';\nimport { AppThunk, RootState } from '../store'; // TODO\nimport { userLogIn, userLogOut, userEditProfile } from '../../apis/index';\nimport { User } from '../../assets/models/User';\n\nconst cookies = new Cookies();\n\ninterface AuthState {\n  user?: User;\n  userDraft?: User;\n}\n\nconst initialState: AuthState = {\n  user: cookies.get<User>('user'),\n  userDraft: cookies.get<User>('userDraft'),\n  // TODO temp for fake logged in user: {\n  //   name: 'Amit Bar',\n  //   email: \"'noneofyobusiness@gmail.com\",\n  //   imageUrl: 'image',\n  //   token: 'fake',\n  // },\n};\n\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action: PayloadAction<User | undefined>) => {\n      state.user = action.payload;\n      if (action.payload) {\n        cookies.set('user', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320, // expires  72 hours after login\n        });\n      } else {\n        cookies.remove('user');\n      }\n    },\n    setUserDraft: (state, action: PayloadAction<User | undefined>) => {\n      state.userDraft = action.payload;\n      if (action.payload) {\n        cookies.set('userDraft', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320, // expires  72 hours after login\n        });\n      } else {\n        cookies.remove('userDraft');\n      }\n    },\n  },\n});\n\n// Export actions that were defined with createSlice\nexport const { setUser, setUserDraft } = authSlice.actions;\n\n// Thunks here\nexport const login = (name: string, email: string): AppThunk => async (\n  dispatch,\n) => {\n  const response = await userLogIn(name, email);\n  if (response) {\n    dispatch(\n      setUser({\n        name: response.name,\n        email: response.email,\n        token: response.token,\n        description: response.description,\n        major: response.major,\n        schoolYear: response.schoolYear,\n        phone: response.phone,\n      }),\n    );\n    dispatch(\n      setUserDraft({\n        name: response.name,\n        email: response.email,\n        token: response.token,\n        description: response.description,\n        major: response.major,\n        schoolYear: response.schoolYear,\n        phone: response.phone,\n      }),\n    );\n  }\n};\n\n// TODO this doesn't seem to be able to handle when the cookie times out\nexport const logout = (): AppThunk => async (dispatch, getState) => {\n  // remove cookies here, which will automatically update the user\n  const token = getState().auth.user?.token;\n  if (!token) return; // TODO doesn't work well anymore. I think it's cause we changed the backend\n\n  const response = await userLogOut(token);\n  if (response) {\n    dispatch(setUser(undefined));\n    dispatch(setUserDraft(undefined)); // TODO not sure if this is needed\n  }\n};\n\nexport const editProfile = (\n  email: string,\n  userDraft: User,\n  kvPairs: any,\n): AppThunk => async (dispatch) => {\n  const response = await userEditProfile(email, kvPairs);\n  \n  if (response) {\n    dispatch(setUser(userDraft));\n  }\n};\n\n// Selects here\nconst selectUser = (state: RootState) => state.auth.user;\nconst selectUserDraft = (state: RootState) => state.auth.userDraft;\nexport { selectUser, selectUserDraft };\n\n// Export everything\nexport default authSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}