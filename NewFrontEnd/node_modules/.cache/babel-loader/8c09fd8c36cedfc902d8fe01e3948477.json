{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport Cookies from 'universal-cookie';\n// TODO\nimport { userLogIn, userLogOut } from '../../apis/index';\nconst cookies = new Cookies();\nconst initialState = {\n  user: cookies.get('user') // TODO temp for fake logged in user: {\n  //   name: 'Amit Bar',\n  //   email: \"'noneofyobusiness@gmail.com\",\n  //   imageUrl: 'image',\n  //   token: 'fake',\n  // },\n\n};\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action) => {\n      state.user = action.payload;\n\n      if (action.payload) {\n        cookies.set('user', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320 // expires  72 hours after login\n\n        });\n      } else {\n        cookies.remove('user');\n      }\n    }\n  }\n}); // Export actions that were defined with createSlice\n\nexport const {\n  setUser\n} = authSlice.actions; // Thunks here\n\nexport const login = (name, email) => async (dispatch) => {\n  const response = await userLogIn(name, email);\n\n  if (response) {\n    dispatch(setUser({\n      name: response.name,\n      email: response.email,\n      token: response.token\n    }));\n  }\n}; // TODO this doesn't seem to be able to handle when the cookie times out\n\nexport const logout = () => async (dispatch, getState) => {\n  var _getState$auth$user;\n\n  // remove cookies here, which will automatically update the user\n  const token = (_getState$auth$user = getState().auth.user) === null || _getState$auth$user === void 0 ? void 0 : _getState$auth$user.token;\n  if (!token) return;\n  const response = await userLogOut(token);\n\n  if (response) {\n    dispatch(setUser(undefined)); // TODO not sure if this is needed\n  }\n}; // Selects here\n\nconst selectUser = state => state.auth.user;\n\nexport { selectUser }; // Export everything\n\nexport default authSlice.reducer;","map":{"version":3,"sources":["/Users/yijianzong/Documents/GitHub/Housing_Proj/NewFrontEnd/src/redux/slices/auth.ts"],"names":["createSlice","Cookies","userLogIn","userLogOut","cookies","initialState","user","get","authSlice","name","reducers","setUser","state","action","payload","set","maxAge","remove","actions","login","email","dispatch","response","token","logout","getState","auth","undefined","selectUser","reducer"],"mappings":"AAAA,SAASA,WAAT,QAA2C,kBAA3C;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACgD;AAChD,SAASC,SAAT,EAAoBC,UAApB,QAAsC,kBAAtC;AAGA,MAAMC,OAAO,GAAG,IAAIH,OAAJ,EAAhB;AAMA,MAAMI,YAAuB,GAAG;AAC9BC,EAAAA,IAAI,EAAEF,OAAO,CAACG,GAAR,CAAkB,MAAlB,CADwB,CAE9B;AACA;AACA;AACA;AACA;AACA;;AAP8B,CAAhC;AAUA,OAAO,MAAMC,SAAS,GAAGR,WAAW,CAAC;AACnCS,EAAAA,IAAI,EAAE,MAD6B;AAEnCJ,EAAAA,YAFmC;AAGnCK,EAAAA,QAAQ,EAAE;AACRC,IAAAA,OAAO,EAAE,CAACC,KAAD,EAAQC,MAAR,KAAoD;AAC3DD,MAAAA,KAAK,CAACN,IAAN,GAAaO,MAAM,CAACC,OAApB;;AACA,UAAID,MAAM,CAACC,OAAX,EAAoB;AAClBV,QAAAA,OAAO,CAACW,GAAR,CAAY,MAAZ,EAAoBF,MAAM,CAACC,OAA3B,EAAoC;AAClC;AACAE,UAAAA,MAAM,EAAE,IAF0B,CAEpB;;AAFoB,SAApC;AAID,OALD,MAKO;AACLZ,QAAAA,OAAO,CAACa,MAAR,CAAe,MAAf;AACD;AACF;AAXO;AAHyB,CAAD,CAA7B,C,CAkBP;;AACA,OAAO,MAAM;AAAEN,EAAAA;AAAF,IAAcH,SAAS,CAACU,OAA9B,C,CAEP;;AACA,OAAO,MAAMC,KAAK,GAAG,CAACV,IAAD,EAAeW,KAAf,KAA2C,OAC9DC,QAD8D,KAE3D;AACH,QAAMC,QAAQ,GAAG,MAAMpB,SAAS,CAACO,IAAD,EAAOW,KAAP,CAAhC;;AACA,MAAIE,QAAJ,EAAc;AACZD,IAAAA,QAAQ,CACNV,OAAO,CAAC;AACNF,MAAAA,IAAI,EAAEa,QAAQ,CAACb,IADT;AAENW,MAAAA,KAAK,EAAEE,QAAQ,CAACF,KAFV;AAGNG,MAAAA,KAAK,EAAED,QAAQ,CAACC;AAHV,KAAD,CADD,CAAR;AAOD;AACF,CAbM,C,CAeP;;AACA,OAAO,MAAMC,MAAM,GAAG,MAAgB,OAAOH,QAAP,EAAiBI,QAAjB,KAA8B;AAAA;;AAClE;AACA,QAAMF,KAAK,0BAAGE,QAAQ,GAAGC,IAAX,CAAgBpB,IAAnB,wDAAG,oBAAsBiB,KAApC;AACA,MAAI,CAACA,KAAL,EAAY;AAEZ,QAAMD,QAAQ,GAAG,MAAMnB,UAAU,CAACoB,KAAD,CAAjC;;AACA,MAAID,QAAJ,EAAc;AACZD,IAAAA,QAAQ,CAACV,OAAO,CAACgB,SAAD,CAAR,CAAR,CADY,CACkB;AAC/B;AACF,CATM,C,CAWP;;AACA,MAAMC,UAAU,GAAIhB,KAAD,IAAsBA,KAAK,CAACc,IAAN,CAAWpB,IAApD;;AAEA,SAASsB,UAAT,G,CAEA;;AACA,eAAepB,SAAS,CAACqB,OAAzB","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport Cookies from 'universal-cookie';\nimport { AppThunk, RootState } from '../store'; // TODO\nimport { userLogIn, userLogOut } from '../../apis/index';\nimport { User } from '../../assets/models/User';\n\nconst cookies = new Cookies();\n\ninterface AuthState {\n  user?: User;\n}\n\nconst initialState: AuthState = {\n  user: cookies.get<User>('user'),\n  // TODO temp for fake logged in user: {\n  //   name: 'Amit Bar',\n  //   email: \"'noneofyobusiness@gmail.com\",\n  //   imageUrl: 'image',\n  //   token: 'fake',\n  // },\n};\n\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action: PayloadAction<User | undefined>) => {\n      state.user = action.payload;\n      if (action.payload) {\n        cookies.set('user', action.payload, {\n          // TODO should probably set this from the backend as well (similar to access_token)\n          maxAge: 4320, // expires  72 hours after login\n        });\n      } else {\n        cookies.remove('user');\n      }\n    },\n  },\n});\n\n// Export actions that were defined with createSlice\nexport const { setUser } = authSlice.actions;\n\n// Thunks here\nexport const login = (name: string, email: string): AppThunk => async (\n  dispatch,\n) => {\n  const response = await userLogIn(name, email);\n  if (response) {\n    dispatch(\n      setUser({\n        name: response.name,\n        email: response.email,\n        token: response.token,\n      }),\n    );\n  }\n};\n\n// TODO this doesn't seem to be able to handle when the cookie times out\nexport const logout = (): AppThunk => async (dispatch, getState) => {\n  // remove cookies here, which will automatically update the user\n  const token = getState().auth.user?.token;\n  if (!token) return;\n\n  const response = await userLogOut(token);\n  if (response) {\n    dispatch(setUser(undefined)); // TODO not sure if this is needed\n  }\n};\n\n// Selects here\nconst selectUser = (state: RootState) => state.auth.user;\n\nexport { selectUser };\n\n// Export everything\nexport default authSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}